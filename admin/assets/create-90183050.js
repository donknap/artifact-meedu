import{f as z,u as G,b as J,r as a,t as X,c7 as p,j as e,S as i,I as q,E as _,c8 as b,B as M,M as Z,m as C,h as ee}from"./index-e664e6dc.js";import{c as te,s as se}from"./topic-b9592fd8.js";import{B as re}from"./index-6997ccbf.js";import{P as le}from"./index-0c53b4ac.js";import{H as n}from"./index-aa5ba88b.js";import{U as ae}from"./index-8bc536fa.js";import{Q as w}from"./index-094b6315.js";import{M as N}from"./index-04c55812.js";import{F as s}from"./index-279b9278.js";import{S as d}from"./index-640f3908.js";import{R as ie,C as R}from"./row-2dac17a4.js";import{S as F}from"./index-65a4c0be.js";import{D as ne}from"./index-011730db.js";import"./LeftOutlined-feda539a.js";import"./InfoCircleOutlined-e72834c1.js";import"./InboxOutlined-6e2e7513.js";import"./selected-33965347.js";import"./Dragger-53e4e55c.js";import"./useForceUpdate-932ad153.js";import"./DeleteOutlined-50171d48.js";import"./CheckOutlined-f7d7f4b2.js";import"./useIcons-0af35028.js";import"./Pagination-2f0e5cb7.js";import"./responsiveObserver-8e0341fc.js";import"./index-f944a168.js";const{confirm:y}=Z,Me=()=>{new URLSearchParams(z().search);const[r]=s.useForm(),E=G(),m=J(),[V,h]=a.useState(!1),[T,O]=a.useState([]),[u,I]=a.useState(0),[P,x]=a.useState(0),[v,B]=a.useState(""),[g,o]=a.useState(""),[j,k]=a.useState(""),[Y,S]=a.useState(""),[K,L]=a.useState(""),f=[{label:"Markdown",value:"markdown"},{label:"富文本编辑器",value:"quill"}];a.useEffect(()=>{document.title="新建图文",E(X("新建图文")),x(0),r.setFieldsValue({is_show:1,is_free:0,is_vip_free:!1}),A()},[]),a.useEffect(()=>{let t=p();k(t==="markdown"?"MARKDOWN":"FULLEDITOR"),o(t||"quill")},[p()]);const A=()=>{te().then(t=>{let l=t.data;const D=[];for(let c=0;c<l.length;c++)D.push({label:l[c].name,value:l[c].id});O(D)})},H=t=>{if(!V){if(t.is_free===1&&(t.charge=0,t.is_vip_free=!1,t.free_content="",t.free_content_render=""),Number(t.charge)%1!==0){C.error("图文价格必须为整数");return}if(t.is_free===0&&Number(t.charge)<=0){C.error("图文价格必须输入且大于0");return}p()==="markdown"?(t.editor="MARKDOWN",t.render_content=Y,t.free_content_render=K):(t.editor="FULLEDITOR",t.render_content=t.original_content,t.free_content_render=t.free_content),t.sorted_at=ee(new Date(t.sorted_at)).format("YYYY-MM-DD HH:mm"),t.is_need_login=0,h(!0),se(t).then(l=>{h(!1),C.success("保存成功！"),m(-1)}).catch(l=>{h(!1)})}},U=t=>{console.log("Failed:",t)},W=t=>{t?r.setFieldsValue({is_show:1}):r.setFieldsValue({is_show:0})},Q=t=>{t?r.setFieldsValue({is_vip_free:!0}):r.setFieldsValue({is_vip_free:!1})},$=t=>{t?(r.setFieldsValue({is_free:1,charge:0}),x(1),I(0)):(r.setFieldsValue({is_free:0}),x(0))};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(re,{title:"新建图文"}),e.jsx("div",{className:"float-left mt-30",children:e.jsxs(s,{form:r,name:"topic-create",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:H,onFinishFailed:U,autoComplete:"off",children:[e.jsx(s.Item,{name:"cid",label:"所属分类",rules:[{required:!0,message:"请选择分类!"}],children:e.jsxs(i,{align:"baseline",style:{height:32},children:[e.jsx(s.Item,{name:"cid",rules:[{required:!0,message:"请选择分类!"}],children:e.jsx(d,{style:{width:300},allowClear:!0,placeholder:"请选择分类",options:T})}),e.jsx("div",{children:e.jsx(le,{type:"link",text:"分类管理",class:"c-primary",icon:null,p:"addons.meedu_topics.category.list",onClick:()=>{m("/topic/category/index")},disabled:null})})]})}),e.jsx(s.Item,{label:"图文名称",name:"title",rules:[{required:!0,message:"请输入图文名称!"}],children:e.jsx(q,{style:{width:300},placeholder:"请输入图文名称",allowClear:!0})}),e.jsx(s.Item,{label:"图文封面",name:"thumb",rules:[{required:!0,message:"请上传图文封面!"}],children:e.jsxs(i,{align:"baseline",style:{height:32},children:[e.jsx(s.Item,{name:"thumb",rules:[{required:!0,message:"请上传图文封面!"}],children:e.jsx(ae,{text:"选择图片",onSelected:t=>{r.setFieldsValue({thumb:t}),B(t)}})}),e.jsx("div",{className:"ml-10",children:e.jsx(n,{text:"建议尺寸400x300 宽高比4:3"})})]})}),v&&e.jsxs(ie,{style:{marginBottom:22},children:[e.jsx(R,{span:3}),e.jsx(R,{span:21,children:e.jsx("div",{className:"normal-thumb-box",style:{backgroundImage:`url(${v})`,width:200,height:150}})})]}),e.jsx(s.Item,{label:"免费",name:"is_free",valuePropName:"checked",children:e.jsx(F,{onChange:$})}),P===0&&e.jsx(s.Item,{label:"价格",name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsxs(i,{align:"baseline",style:{height:32},children:[e.jsx(s.Item,{name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsx(q,{style:{width:300},placeholder:"单位：元",allowClear:!0,type:"number",onChange:t=>{I(Number(t.target.value))}})}),e.jsx("div",{className:"ml-10",children:e.jsx(n,{text:"请输入整数"})})]})}),u>0&&e.jsx(s.Item,{label:"会员免费",name:"is_vip_free",children:e.jsxs(i,{align:"baseline",style:{height:32},children:[e.jsx(s.Item,{name:"is_vip_free",valuePropName:"checked",children:e.jsx(F,{onChange:Q})}),e.jsx("div",{className:"ml-10",children:e.jsx(n,{text:"如果开启该选项，则购买VIP会员的学员可以无需购买即可观看该电子书。"})})]})}),e.jsx(s.Item,{label:"上架时间",required:!0,children:e.jsxs(i,{align:"baseline",style:{height:32},children:[e.jsx(s.Item,{name:"sorted_at",rules:[{required:!0,message:"请选择上架时间!"}],children:e.jsx(ne,{format:"YYYY-MM-DD HH:mm",style:{width:300},showTime:!0,placeholder:"请选择上架时间"})}),e.jsx("div",{className:"ml-10",children:e.jsx(n,{text:"上架时间越晚，排序越靠前"})})]})}),e.jsx(s.Item,{label:"显示",name:"is_show",children:e.jsxs(i,{align:"baseline",style:{height:32},children:[e.jsx(s.Item,{name:"is_show",valuePropName:"checked",children:e.jsx(F,{onChange:W})}),e.jsx("div",{className:"ml-10",children:e.jsx(n,{text:"关闭后电此图文在前台隐藏显示"})})]})}),u>0&&e.jsxs(e.Fragment,{children:[e.jsx(s.Item,{label:"免费内容",name:"free_content",rules:[{required:!0,message:"请输入付费内容!"}],style:{height:840},children:e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"w-800px",children:j==="MARKDOWN"?e.jsx(N,{height:800,defautValue:"",setContent:(t,l)=>{r.setFieldsValue({free_content:t}),L(l)}}):e.jsx(w,{mode:"",height:800,defautValue:"",isFormula:!1,setContent:t=>{r.setFieldsValue({free_content:t})}})}),e.jsx("div",{className:"ml-30",children:e.jsx(d,{value:g,style:{width:150},onChange:t=>{y({title:"警告",icon:e.jsx(_,{}),content:"切换编辑器将清空已编辑文章内容，是否切换？",centered:!0,okText:"确认",cancelText:"取消",onOk(){o(t),b(t)},onCancel(){console.log("Cancel")}})},placeholder:"请选择",options:f})})]})}),e.jsx(s.Item,{label:"付费内容",name:"original_content",rules:[{required:!0,message:"请输入付费内容!"}],style:{height:840},children:e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"w-800px",children:j==="MARKDOWN"?e.jsx(N,{height:800,defautValue:"",setContent:(t,l)=>{r.setFieldsValue({original_content:t}),S(l)}}):e.jsx(w,{mode:"",height:800,defautValue:"",isFormula:!1,setContent:t=>{r.setFieldsValue({original_content:t})}})}),e.jsx("div",{className:"ml-30",children:e.jsx(d,{value:g,style:{width:150},onChange:t=>{y({title:"警告",icon:e.jsx(_,{}),content:"切换编辑器将清空已编辑文章内容，是否切换？",centered:!0,okText:"确认",cancelText:"取消",onOk(){o(t),b(t)},onCancel(){console.log("Cancel")}})},placeholder:"请选择",options:f})})]})})]}),u===0&&e.jsx(s.Item,{label:"文章内容",name:"original_content",rules:[{required:!0,message:"请输入文章内容!"}],style:{height:840},children:e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"w-800px",children:j==="MARKDOWN"?e.jsx(N,{height:800,defautValue:"",setContent:(t,l)=>{r.setFieldsValue({original_content:t}),S(l)}}):e.jsx(w,{mode:"",height:800,defautValue:"",isFormula:!1,setContent:t=>{r.setFieldsValue({original_content:t})}})}),e.jsx("div",{className:"ml-30",children:e.jsx(d,{value:g,style:{width:150},onChange:t=>{y({title:"警告",icon:e.jsx(_,{}),content:"切换编辑器将清空已编辑文章内容，是否切换？",centered:!0,okText:"确认",cancelText:"取消",onOk(){o(t),b(t)},onCancel(){console.log("Cancel")}})},placeholder:"请选择",options:f})})]})})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(M,{loading:V,type:"primary",onClick:()=>r.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(M,{type:"default",onClick:()=>m(-1),children:"取消"})})]})})]})};export{Me as default};
