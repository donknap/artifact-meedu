import{r as s,j as e,M as w,I as j,S as y,m as S,g as v,u as L,f as q,t as U,E as T}from"./index-e664e6dc.js";import{E as V,F as B,G as P,H as W,I as A}from"./course-a9e2e142.js";import{B as H}from"./index-6997ccbf.js";import{P as b}from"./index-0c53b4ac.js";import{H as F}from"./index-aa5ba88b.js";import{F as i}from"./index-279b9278.js";import{T as O}from"./Table-ee9d831a.js";import"./LeftOutlined-feda539a.js";import"./InfoCircleOutlined-e72834c1.js";import"./row-2dac17a4.js";import"./responsiveObserver-8e0341fc.js";import"./addEventListener-263e58b1.js";import"./useIcons-0af35028.js";import"./CheckOutlined-f7d7f4b2.js";import"./Pagination-2f0e5cb7.js";import"./useForceUpdate-932ad153.js";import"./index-640f3908.js";import"./index-fa5b0e30.js";import"./iconUtil-a09ccdfb.js";const R=t=>{const[l]=i.useForm(),[n,a]=s.useState(!1);s.useEffect(()=>{t.open&&l.setFieldsValue({title:"",sort:""})},[t.open,t.cid]);const h=c=>{n||(a(!0),V(t.cid,c).then(f=>{a(!1),S.success("成功！"),t.onSuccess()}).catch(f=>{a(!1)}))},o=c=>{console.log("Failed:",c)};return e.jsx(e.Fragment,{children:t.open?e.jsx(w,{title:"添加章节",onCancel:()=>{t.onCancel()},open:!0,width:800,maskClosable:!1,onOk:()=>{l.submit()},centered:!0,children:e.jsx("div",{className:"float-left mt-30",children:e.jsxs(i,{form:l,name:"course-chapter-create-dailog",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:h,onFinishFailed:o,autoComplete:"off",children:[e.jsx(i.Item,{label:"章节名称",name:"title",rules:[{required:!0,message:"请输入章节名称!"}],children:e.jsx(j,{style:{width:300},placeholder:"请输入章节名称",allowClear:!0})}),e.jsx(i.Item,{label:"排序",name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsxs(y,{align:"baseline",style:{height:32},children:[e.jsx(i.Item,{name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsx(j,{type:"number",style:{width:300},placeholder:"填输入排序",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(F,{text:"填写整数，数字越小排序越靠前"})})]})})]})})}):null})},M=t=>{const[l]=i.useForm(),[n,a]=s.useState(!0),[h,o]=s.useState(!1);s.useEffect(()=>{t.open&&(a(!0),l.setFieldsValue({title:"",sort:""})),t.id>0&&t.cid&&c()},[t.open,t.cid,t.id]);const c=async()=>{await f(),a(!1)},f=async()=>{const d=await B(t.cid,t.id);l.setFieldsValue({title:d.data.title,sort:d.data.sort})},g=d=>{h||(o(!0),P(t.cid,t.id,d).then(p=>{o(!1),S.success("成功！"),t.onSuccess()}).catch(p=>{o(!1)}))},x=d=>{console.log("Failed:",d)};return e.jsx(e.Fragment,{children:t.open?e.jsxs(w,{title:"编辑章节",onCancel:()=>{t.onCancel()},open:!0,width:800,maskClosable:!1,onOk:()=>{l.submit()},centered:!0,children:[n&&e.jsx("div",{className:"float-left text-center mt-30",children:e.jsx(v,{})}),e.jsx("div",{style:{display:n?"none":"block"},className:"float-left mt-30",children:e.jsxs(i,{form:l,name:"course-chapter-update-dailog",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:g,onFinishFailed:x,autoComplete:"off",children:[e.jsx(i.Item,{label:"章节名称",name:"title",rules:[{required:!0,message:"请输入章节名称!"}],children:e.jsx(j,{style:{width:300},placeholder:"请输入章节名称",allowClear:!0})}),e.jsx(i.Item,{label:"排序",name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsxs(y,{align:"baseline",style:{height:32},children:[e.jsx(i.Item,{name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsx(j,{type:"number",style:{width:300},placeholder:"填输入排序",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(F,{text:"填写整数，数字越小排序越靠前"})})]})})]})})]}):null})},{confirm:G}=w,ue=()=>{const t=L(),l=new URLSearchParams(q().search),[n,a]=s.useState(!1),[h,o]=s.useState([]),[c,f]=s.useState(!1),[g,x]=s.useState(!1),[d,p]=s.useState(!1),[k,I]=s.useState(0),[m,E]=s.useState(Number(l.get("course_id")));s.useEffect(()=>{document.title="课程章节管理",t(U("课程章节管理"))},[]),s.useEffect(()=>{E(Number(l.get("course_id")))},[l.get("course_id")]),s.useEffect(()=>{N()},[m,c]);const N=()=>{n||(a(!0),W(m,{course_id:m}).then(r=>{o(r.data.chapters),a(!1)}).catch(r=>{a(!1)}))},_=[{title:"排序",width:150,render:(r,u)=>e.jsx("span",{children:u.sort})},{title:"章节",render:(r,u)=>e.jsxs("span",{children:[u.title," "]})},{title:"操作",width:160,fixed:"right",render:(r,u)=>e.jsxs(y,{children:[e.jsx(b,{type:"link",text:"编辑",class:"c-primary",icon:null,p:"course_chapter.update",onClick:()=>{I(u.id),p(!0)},disabled:null}),e.jsx(b,{type:"link",text:"删除",class:"c-red",icon:null,p:"course_chapter.destroy",onClick:()=>{D(u.id)},disabled:null})]})}],C=()=>{o([]),f(!c)},D=r=>{r!==0&&G({title:"操作确认",icon:e.jsx(T,{}),content:"确认删除此章节？",centered:!0,okText:"确认",cancelText:"取消",onOk(){n||(a(!0),A(m,r).then(()=>{a(!1),S.success("删除成功"),C()}).catch(u=>{a(!1)}))},onCancel(){console.log("Cancel")}})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(H,{title:"课程章节管理"}),e.jsx(R,{cid:m,open:g,onCancel:()=>x(!1),onSuccess:()=>{C(),x(!1)}}),e.jsx(M,{id:k,cid:m,open:d,onCancel:()=>p(!1),onSuccess:()=>{C(),p(!1)}}),e.jsx("div",{className:"float-left  mt-30 mb-30",children:e.jsx(b,{type:"primary",text:"添加章节",class:"",icon:null,p:"course_chapter.store",onClick:()=>x(!0),disabled:null})}),e.jsx("div",{className:"float-left",children:e.jsx(O,{loading:n,columns:_,dataSource:h,rowKey:r=>r.id,pagination:!1})})]})};export{ue as default};
