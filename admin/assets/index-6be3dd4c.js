import{r as s,j as e,M as w,I as j,S as y,m as S,g as E,u as L,f as q,t as U,E as B}from"./index-e664e6dc.js";import{v as T,w as V,x as P,y as W,z as A}from"./book-7a089476.js";import{B as O}from"./index-6997ccbf.js";import{P as C}from"./index-0c53b4ac.js";import{H as k}from"./index-aa5ba88b.js";import{F as i}from"./index-279b9278.js";import{T as R}from"./Table-ee9d831a.js";import"./LeftOutlined-feda539a.js";import"./InfoCircleOutlined-e72834c1.js";import"./row-2dac17a4.js";import"./responsiveObserver-8e0341fc.js";import"./addEventListener-263e58b1.js";import"./useIcons-0af35028.js";import"./CheckOutlined-f7d7f4b2.js";import"./Pagination-2f0e5cb7.js";import"./useForceUpdate-932ad153.js";import"./index-640f3908.js";import"./index-fa5b0e30.js";import"./iconUtil-a09ccdfb.js";const H=t=>{const[l]=i.useForm(),[d,a]=s.useState(!1);s.useEffect(()=>{t.open&&l.setFieldsValue({name:"",sort:""})},[t.open,t.cid]);const m=r=>{d||(a(!0),r.bid=t.cid,T(r).then(h=>{a(!1),S.success("成功！"),t.onSuccess()}).catch(h=>{a(!1)}))},u=r=>{console.log("Failed:",r)};return e.jsx(e.Fragment,{children:t.open?e.jsx(w,{title:"添加章节",onCancel:()=>{t.onCancel()},open:!0,width:800,maskClosable:!1,onOk:()=>{l.submit()},centered:!0,children:e.jsx("div",{className:"float-left mt-30",children:e.jsxs(i,{form:l,name:"live-chapter-create-dailog",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:m,onFinishFailed:u,autoComplete:"off",children:[e.jsx(i.Item,{label:"章节名称",name:"name",rules:[{required:!0,message:"请输入章节名称!"}],children:e.jsx(j,{style:{width:300},placeholder:"请输入章节名称",allowClear:!0})}),e.jsx(i.Item,{label:"排序",name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsxs(y,{align:"baseline",style:{height:32},children:[e.jsx(i.Item,{name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsx(j,{type:"number",style:{width:300},placeholder:"填输入排序",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(k,{text:"填写整数，数字越小排序越靠前"})})]})})]})})}):null})},M=t=>{const[l]=i.useForm(),[d,a]=s.useState(!0),[m,u]=s.useState(!1);s.useEffect(()=>{t.open&&(a(!0),l.setFieldsValue({name:"",sort:""})),t.id>0&&t.cid&&r()},[t.open,t.cid,t.id]);const r=async()=>{await h(),a(!1)},h=async()=>{const o=await V(t.id);l.setFieldsValue({name:o.data.name,sort:o.data.sort})},b=o=>{m||(u(!0),o.bid=t.cid,P(t.id,o).then(x=>{u(!1),S.success("成功！"),t.onSuccess()}).catch(x=>{u(!1)}))},f=o=>{console.log("Failed:",o)};return e.jsx(e.Fragment,{children:t.open?e.jsxs(w,{title:"编辑章节",onCancel:()=>{t.onCancel()},open:!0,width:800,maskClosable:!1,onOk:()=>{l.submit()},centered:!0,children:[d&&e.jsx("div",{className:"float-left text-center mt-30",children:e.jsx(E,{})}),e.jsx("div",{style:{display:d?"none":"block"},className:"float-left mt-30",children:e.jsxs(i,{form:l,name:"live-chapter-update-dailog",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:b,onFinishFailed:f,autoComplete:"off",children:[e.jsx(i.Item,{label:"章节名称",name:"name",rules:[{required:!0,message:"请输入章节名称!"}],children:e.jsx(j,{style:{width:300},placeholder:"请输入章节名称",allowClear:!0})}),e.jsx(i.Item,{label:"排序",name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsxs(y,{align:"baseline",style:{height:32},children:[e.jsx(i.Item,{name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsx(j,{type:"number",style:{width:300},placeholder:"填输入排序",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(k,{text:"填写整数，数字越小排序越靠前"})})]})})]})})]}):null})},{confirm:z}=w,ue=()=>{const t=L(),l=new URLSearchParams(q().search),[d,a]=s.useState(!1),[m,u]=s.useState([]),[r,h]=s.useState(!1),[b,f]=s.useState(!1),[o,x]=s.useState(!1),[F,I]=s.useState(0),[p,D]=s.useState(Number(l.get("bid")));s.useEffect(()=>{document.title="电子书章节管理",t(U("电子书章节管理"))},[]),s.useEffect(()=>{D(Number(l.get("bid")))},[l.get("bid")]),s.useEffect(()=>{N()},[p,r]);const N=()=>{d||(a(!0),W({bid:p}).then(n=>{u(n.data),a(!1)}).catch(n=>{a(!1)}))},_=[{title:"ID",width:150,render:(n,c)=>e.jsx("span",{children:c.id})},{title:"排序",width:150,render:(n,c)=>e.jsx("span",{children:c.sort})},{title:"章节",render:(n,c)=>e.jsxs("span",{children:[c.name," "]})},{title:"操作",width:160,fixed:"right",render:(n,c)=>e.jsxs(y,{children:[e.jsx(C,{type:"link",text:"编辑",class:"c-primary",icon:null,p:"addons.meedu_books.book_chapter.update",onClick:()=>{I(c.id),x(!0)},disabled:null}),e.jsx(C,{type:"link",text:"删除",class:"c-red",icon:null,p:"addons.meedu_books.book_chapter.delete",onClick:()=>{v(c.id)},disabled:null})]})}],g=()=>{u([]),h(!r)},v=n=>{n!==0&&z({title:"操作确认",icon:e.jsx(B,{}),content:"确认删除此章节？",centered:!0,okText:"确认",cancelText:"取消",onOk(){d||(a(!0),A(n).then(()=>{a(!1),S.success("删除成功"),g()}).catch(c=>{a(!1)}))},onCancel(){console.log("Cancel")}})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(O,{title:"电子书章节管理"}),e.jsx(H,{cid:p,open:b,onCancel:()=>f(!1),onSuccess:()=>{g(),f(!1)}}),e.jsx(M,{id:F,cid:p,open:o,onCancel:()=>x(!1),onSuccess:()=>{g(),x(!1)}}),e.jsx("div",{className:"float-left  mt-30 mb-30",children:e.jsx(C,{type:"primary",text:"添加章节",class:"",icon:null,p:"addons.meedu_books.book_chapter.store",onClick:()=>f(!0),disabled:null})}),e.jsx("div",{className:"float-left",children:e.jsx(R,{loading:d,columns:_,dataSource:m,rowKey:n=>n.id,pagination:!1})})]})};export{ue as default};
