import{f as L,u as U,b as K,r as i,t as O,j as e,g as Q,S as d,I as T,B as y,h as W,m as z}from"./index-e664e6dc.js";import{p as G,n as J,a as X,q as Z}from"./book-7a089476.js";import{B as $}from"./index-6997ccbf.js";import{P as ee}from"./index-0c53b4ac.js";import{H as p}from"./index-aa5ba88b.js";import{Q as te}from"./index-094b6315.js";import{M as se}from"./index-04c55812.js";import{d as ae,D as ie}from"./index-011730db.js";import{F as a}from"./index-279b9278.js";import{S as re}from"./index-640f3908.js";import{S as w}from"./index-65a4c0be.js";import"./LeftOutlined-feda539a.js";import"./InfoCircleOutlined-e72834c1.js";import"./index-f944a168.js";import"./InboxOutlined-6e2e7513.js";import"./selected-33965347.js";import"./Dragger-53e4e55c.js";import"./useForceUpdate-932ad153.js";import"./DeleteOutlined-50171d48.js";import"./CheckOutlined-f7d7f4b2.js";import"./row-2dac17a4.js";import"./responsiveObserver-8e0341fc.js";import"./useIcons-0af35028.js";import"./Pagination-2f0e5cb7.js";const Ve=()=>{const l=new URLSearchParams(L().search),[r]=a.useForm(),S=U(),m=K(),[x,k]=i.useState(!0),[g,h]=i.useState(!1),[N,C]=i.useState([]),[D,F]=i.useState(0),[b,I]=i.useState(""),[u,V]=i.useState(""),[Y,j]=i.useState(""),[n,v]=i.useState(Number(l.get("id"))),[o,M]=i.useState(Number(l.get("bid")));i.useEffect(()=>{document.title="编辑电子书文章",S(O("编辑电子书文章")),B()},[n,o]),i.useEffect(()=>{v(Number(l.get("id"))),M(Number(l.get("bid"))),f()},[l.get("id"),l.get("bid")]);const B=async()=>{await P(),await H(),await f(),k(!1)},f=async()=>{if(n===0)return;var s=(await G(n)).data;r.setFieldsValue({book_cid:s.book_cid==0?[]:s.book_cid,title:s.title,is_show:s.is_show,trySee:s.charge===0?1:0,original_content:s.original_content,charge:s.charge,published_at:ae(s.published_at,"YYYY-MM-DD HH:mm")}),V(s.editor),I(s.original_content),j(s.render_content)},H=async()=>{let s=(await J({})).data.chapters[o];if(s){const _=[];for(let c=0;c<s.length;c++)_.push({label:s[c].name,value:s[c].id});C(_)}},P=async()=>{const t=await X(o);F(t.data.charge)},E=t=>{g||(t.editor=u,u==="MARKDOWN"?t.render_content=Y:t.render_content=t.original_content,t.bid=o,t.published_at=W(new Date(t.published_at)).format("YYYY-MM-DD HH:mm"),h(!0),Z(n,t).then(s=>{h(!1),z.success("保存成功！"),m(-1)}).catch(s=>{h(!1)}))},q=t=>{console.log("Failed:",t)},R=t=>{t?r.setFieldsValue({is_show:1}):r.setFieldsValue({is_show:0})},A=t=>{t?r.setFieldsValue({trySee:1}):r.setFieldsValue({trySee:0})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx($,{title:"编辑电子书文章"}),x&&e.jsx("div",{className:"float-left text-center mt-30",children:e.jsx(Q,{})}),e.jsx("div",{style:{display:x?"none":"block"},className:"float-left mt-30",children:e.jsxs(a,{form:r,name:"book-article-update",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:E,onFinishFailed:q,autoComplete:"off",children:[e.jsx(a.Item,{name:"book_cid",label:"章节",children:e.jsxs(d,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"book_cid",children:e.jsx(re,{style:{width:300},allowClear:!0,placeholder:"请选择章节",options:N})}),e.jsx("div",{children:e.jsx(ee,{type:"link",text:"章节管理",class:"c-primary",icon:null,p:"addons.meedu_books.book_chapter.list",onClick:()=>{m("/meedubook/chapter/index?bid="+o)},disabled:null})})]})}),e.jsx(a.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题!"}],children:e.jsx(T,{style:{width:300},placeholder:"请输入标题",allowClear:!0})}),e.jsx(a.Item,{label:"上架时间",required:!0,children:e.jsxs(d,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"published_at",rules:[{required:!0,message:"请选择上架时间!"}],children:e.jsx(ie,{format:"YYYY-MM-DD HH:mm",style:{width:300},showTime:!0,placeholder:"请选择上架时间"})}),e.jsx("div",{className:"ml-10",children:e.jsx(p,{text:"上架时间越晚，排序越靠前"})})]})}),D>0&&e.jsx(a.Item,{label:"试看",name:"trySee",children:e.jsxs(d,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"trySee",valuePropName:"checked",children:e.jsx(w,{onChange:A})}),e.jsx("div",{className:"ml-10",children:e.jsx(p,{text:"开启试看的话未购买电子书学员可直接浏览该篇文章。"})})]})}),e.jsx(a.Item,{label:"显示文章",name:"is_show",children:e.jsxs(d,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"is_show",valuePropName:"checked",children:e.jsx(w,{onChange:R})}),e.jsx("div",{className:"ml-10",children:e.jsx(p,{text:"关闭后电子书文章在前台隐藏显示"})})]})}),e.jsx(a.Item,{label:"文章内容",name:"original_content",rules:[{required:!0,message:"请输入文章内容!"}],style:{height:840},children:e.jsx("div",{className:"w-800px",children:u==="MARKDOWN"?e.jsx(se,{height:800,defautValue:b,setContent:(t,s)=>{r.setFieldsValue({original_content:t}),j(s)}}):e.jsx(te,{mode:"",height:800,defautValue:b,isFormula:!1,setContent:t=>{r.setFieldsValue({original_content:t})}})})})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(y,{loading:g,type:"primary",onClick:()=>r.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(y,{type:"default",onClick:()=>m(-1),children:"取消"})})]})})]})};export{Ve as default};
